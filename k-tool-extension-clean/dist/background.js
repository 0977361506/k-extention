function e(){document.getElementById("ktool-root")?console.log("✅ K-Tool already active on this page"):console.log("🚀 K-Tool not detected, will be injected by content script")}let s;console.log("🚀 K-Tool Extension Background Script loaded"),chrome.runtime.onInstalled.addListener(e=>{console.log("📦 K-Tool Extension installed:",e.reason),"install"===e.reason&&chrome.storage.sync.set({extensionSettings:{apiKey:"",urlTemplate:"",customPrompt:"",documentUrl:"",databaseUrl:"",instructionUrl:"",isEnabled:!0,selectedModel:"sonar-pro"}})}),chrome.runtime.onMessage.addListener((e,s,n)=>{switch(console.log("📨 Background received message:",e),e.action){case"getSettings":return async function(e){try{e({success:!0,settings:(await chrome.storage.sync.get(["extensionSettings"])).extensionSettings||{}})}catch(s){console.error("❌ Error getting settings:",s),e({success:!1,error:s.message})}}(n),!0;case"saveSettings":return async function(e,s){try{await chrome.storage.sync.set({extensionSettings:e}),s({success:!0})}catch(e){console.error("❌ Error saving settings:",e),s({success:!1,error:e.message})}}(e.settings,n),!0;case"checkPermissions":return async function(e){try{e({success:!0,permissions:await chrome.permissions.getAll()})}catch(s){console.error("❌ Error checking permissions:",s),e({success:!1,error:s.message})}}(n),!0;default:console.warn("❓ Unknown action:",e.action),n({success:!1,error:"Unknown action"})}}),chrome.tabs.onUpdated.addListener((s,n,t)=>{"complete"===n.status&&t.url&&(t.url.includes("confluence")||t.url.includes("atlassian")||t.url.includes("localhost:8090"))&&(console.log("🔍 Confluence page detected:",t.url),chrome.scripting.executeScript({target:{tabId:s},func:e}).catch(e=>{console.log("Content script already injected or error:",e.message)}))}),chrome.storage.onChanged.addListener((e,s)=>{"sync"===s&&e.extensionSettings&&(console.log("⚙️ Settings changed:",e.extensionSettings),chrome.tabs.query({},s=>{s.forEach(s=>{s.url&&(s.url.includes("confluence")||s.url.includes("atlassian")||s.url.includes("localhost:8090"))&&chrome.tabs.sendMessage(s.id,{action:"settingsChanged",settings:e.extensionSettings.newValue}).catch(e=>{})})}))}),s=setInterval(()=>{chrome.runtime.getPlatformInfo(()=>{})},2e4),chrome.runtime.onSuspend.addListener(()=>{console.log("💤 Background script suspending"),s&&(clearInterval(s),s=null)}),console.log("✅ K-Tool Extension Background Script ready");
//# sourceMappingURL=background.js.map